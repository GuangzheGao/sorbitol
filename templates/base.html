<!DOCTYPE html>
<html>
<head>
  <!-- Firebase -->
  <script src='https://cdn.firebase.com/js/client/1.0.11/firebase.js'></script>
  <script type='text/javascript' src='https://cdn.firebase.com/js/simple-login/1.3.2/firebase-simple-login.js'></script>

  <!-- Bootstrap core CSS -->
  <link href="/static/css/bootstrap.min.css" rel="stylesheet">
  <!-- self defin css-->
  <link href="/static/css/style.css" rel="stylesheet">
  <!-- jquery -->
  <script type="text/javascript" src="/static/js/jquery-1.11.0.js"></script>
  <script src="/static/js/bootstrap.js"></script>
  <script type="text/javascript" src="/static/js/custom.js"></script>
  <title>{% block title %}{% endblock %} - sorbitol</title>
</head>

<body>
  <!-- Navbar Begins -->
  {% if user %}
  <div class="sorbitol-navbar navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="navbar-board">
      <a id="board-menu" data-toggle="dropdown" class="btn btn-header btn-default btn-sm header-btn-text" href="#">
        <span class="glyphicon glyphicon-tasks header-btn-icon"></span> Boards
      </a>
      <ul aria-labelledby="board-menu" class="board-menu dropdown-menu" role="menu">
        <li class="board-menu-title"><span class="glyphicon glyphicon-tasks"></span> My Boards</li>
        <!-- for board in boards -->
        <li class="btn board-menu-list">{board.name}</li>
        <li class="btn board-menu-list">{board.name}</li>
        <li class="btn board-menu-list">{board.name}</li>
        <!--end for-->
      </ul>
    </div>

    <div class="header-user">
      <div class="js-open-header-menu header-user-add">
        <a id="add-menu" type="button" data-toggle="dropdown" class="btn btn-header btn-default btn-sm header-btn js-open-add-menu" data-target="#">
            <span class="glyphicon glyphicon-plus header-btn-icon"></span>
        </a>

        <ul aria-labelledby="add-menu" class="header-dropdown-menu-add header-dropdown-menu dropdown-menu list-group" role="menu">
          <li class="add-entry board-menu-title">Add...</li>
          <!-- for board in boards -->
          <a class="add-entry js-new-board list-group-item" href="#"><h4 class="head-dropdown-menu-heading list-group-item-heading">New Board...</h4><p class="list-group-item-text">A board is a collection of cards ordered in a list of lists. Use it to manage a project, track a collection, or organize anything.</p></a>
          <a class="add-entry js-new-group list-group-item" href="#"><h4 class="head-dropdown-menu-heading list-group-item-heading">New Group...</h4><p class="list-group-item-text">An organization is a group of boards and people. Use it to group boards in your company, team, or family.</p></a>
          <!--end for-->

          <li class="add-board-detail">Create Board</li>
          <form class="add-board-detail">
            <label for="boardNewTitle">Title</label>
            <input id="boardNewTitle" type="text" name="name" class="js-stop-propagation" placeholder="Untitled Board">
            <label class="left" style="margin-right: 8px;">Organization</label>
            <select class="js-stop-propagation" name="org-id">
              <option class="js-stop-propagation" value="534d94e01c278a4c68bba5b4">Sorbital</option>
            </select>
            <input type="submit" class="primary wide js-submit" value="Create">
          </form>

          <li class="add-board-detail">Create Group</li>
          <form class="add-group-detail">
            <label for="boardNewTitle">Name</label>
            <input id="boardNewTitle" type="text" name="name" class="js-stop-propagation" placeholder="Untitled Board">
            <label class="left" style="margin-right: 8px;">Description</label>
            <textarea id="org-desc" class="js-stop-propagation" name="desc" type="text"></textarea>
            <input type="submit" class="primary wide js-submit" value="Create">
          </form>
        </ul>
      </div>
      <div class="js-open-header-menu header-user-user">
        <a id="user-menu" type="button" data-toggle="dropdown" class="btn btn-header btn-default btn-sm header-btn header-member js-open-header-member-menu header-btn-text" data-target="#">
            {current_user.name}
        </a>
        <ul aria-labelledby="user-menu" class="header-dropdown-menu dropdown-menu" role="menu">
          <li class="board-menu-title">{current_user.username}</li>
          <!-- for board in boards -->
          <a class="list-group-item head-dropdown-menu-heading" href="#">Profile</a>
          <a class="list-group-item head-dropdown-menu-heading" href="#">Cards</a>
          <a class="list-group-item head-dropdown-menu-heading" href="#">Settings</a>
          <a class="list-group-item head-dropdown-menu-heading" href="#">Logout</a>
          <!--end for-->
        </ul>
      </div>
      <div class="js-open-header-menu header-user-notification">
        <a id="notification-menu" data-toggle="dropdown" class="btn btn-header btn-default btn-sm header-btn header-notifications dropdown-toggle" data-target="#">
          <span class="glyphicon glyphicon-bell header-btn-icon"></span>
        </a>
        <ul aria-labelledby="notification-menu" class="header-dropdown-menu dropdown-menu" role="menu">
          <li class="board-menu-title">Notifications</li>
          <!-- for board in boards -->
          <a class="list-group-item head-dropdown-menu-heading" href="#">Notification 1</a>
          <a class="list-group-item head-dropdown-menu-heading" href="#">Notification 2</a>
          <a class="list-group-item head-dropdown-menu-heading" href="#">Notification 3</a>
          <a class="list-group-item head-dropdown-menu-heading" href="#">See all Notifications</a>
          <!--end for-->
        </ul>
      </div>
    </div>
  </div>
  {% endif %}
  <!-- Navbar Ends -->
  {% block content %}{% endblock %}
  {% block javascript %}{% endblock %}


  <!-- add javascript notification based on firebase -->
  <script type='text/javascript'>

    {% if user %}
    $(document).ready(function() {
        var myDataRef = new Firebase('https://dazzling-fire-9098.firebaseio.com/');
        var auth = new FirebaseSimpleLogin(myDataRef, function(error, user) {
            if (!error) {
            // Success!
            }
            else{
                alert(error + " " + user);
            }
        });

        auth.login('password', {
          email: 'guangzhegao@gmail.com',
          password: 'root'
        });


        // listen other user sends
        myDataRef.child({{ user.get_id() }} + "/msg_recv").on("child_added",
        function(newMessageSnapshot) {
            renderNotification(newMessageSnapshot.val());
            //newMessageSnapshot.ref().remove(); //TODO: remove the notification when be read
        });

        function renderNotification(incomeMSG){
            var id_sender = incomeMSG.id_sender;
            var info_sender = incomeMSG.info_sender;
        }

        //Send a message to another user, should be in places necessary
        myDataRef.child(3).child("msg_recv").push({id_sender: {{user.get_id()}}, info_sender:"blabla" });//TODO:  add to place where msg push happens
    });
    {% endif %}

  </script>

</body>
</html>